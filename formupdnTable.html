<!DOCTYPE html>
<html lang="en">
<head>
<title>formUpDown/a jQuery plug-in demo</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css">
  h1 {
    background: bisque;
    padding: 3px 0px 3px 5px;
  }
  table {
    border: chocolate solid 2px;
    width: 80%;
    border-collapse:collapse;
  }
  th {
    background-color: bisque;
    border: bisque solid 1px;
    padding:3px;
  }
  td {
    border: bisque solid 1px;
    padding:3px;
  }
</style>
</head>
<body>
<script type="text/javascript" src="./jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="./jquery.hotkeys-0.7.8.js"></script>
<script type="text/javascript">
<!--
var focusElem;  // points to an element that is currently focused.
var jFormElem;  // list of elements (jquery object) inside a form.
var jFormLeng;  // number of elements.

$(document).ready( function() 
{
	// generate an array of elements inside a form.
	jFormElem = 
		$( 'form' ).map( function() {
			var ele = $.makeArray( this.elements );
			return ele;
		}).filter( function() {
			if( this.type == 'hidden' ) {
				return false;
			}
			return true;
		}).each( function(i) {
			$(this).data( 'focusIndex', i.toString() );
		});
	jFormLeng = jFormElem.length;
	
	// set focusElem if an element is focused. 
	$(jFormElem).focus( function() {
		focusElem = jQuery( this );
	});
	// focus the first element.
	jFormElem.get(1).focus();
    
	// +--------------------------------------------------------------+
    /**
     * Ctrl+RIGHT: go to the next element.
     */
    var formRight =function( event ) 
	{
		var keyPropagate = true;
		if( !focusElem ) return keyPropagate;
		if( !$(focusElem).data( 'focusIndex' ) ) return keyPropagate;
		
		var fIndex = parseInt( $(focusElem).data( 'focusIndex' ) );
		
		if( fIndex == jFormLeng-1 ) {
			$(jFormElem).get(0).focus();
		}
		else {
			$(jFormElem).get( fIndex+1 ).focus();
		}
		keyPropagate = false;
		return keyPropagate;
	};
	$(jFormElem).bind( 'keydown', 'ctrl+right', formRight );
	
    // +--------------------------------------------------------------+
	/** 
     * Ctrl+Left: go to the previous element.
     */
    var formLeft = function( event ) 
	{
		var keyPropagate = true;
		if( !focusElem ) return keyPropagate;
		if( !$(focusElem).data( 'focusIndex' ) ) return keyPropagate;
		
		var fIndex = parseInt( $(focusElem).data( 'focusIndex' ) );
		if( fIndex == 0 ) {
			$(jFormElem).get( jFormLeng-1 ).focus();
		} 
		else {
			$(jFormElem).get( fIndex-1 ).focus();
		}
		keyPropagate = false;
		return keyPropagate;
	};
	$(jFormElem).bind( 'keydown', 'ctrl+left', formLeft );
    
	// +--------------------------------------------------------------+
	/**
     * Ctrl+DOWNç go down the table or the next element.
     */
    var formDown = function( event ) 
	{
		var keyPropagate = true;
		if( !focusElem ) return keyPropagate;
		if( !$(focusElem).data( 'focusIndex' ) ) return keyPropagate;
		
		var fIndex = parseInt( $(focusElem).data( 'focusIndex' ) );
		
		// find an element to focus.
		var fName  = $(focusElem).attr( 'name' );
		if( fName.match( /\[/ ) ) 
		{
			var fNameBody     = fName.match( /^([\w]+)/ )[0];
			var toFocus_idx   = '-1'; // next element with same table name. 
			var follow_item   = '-1'; // just the next element.
			var top_item      = '-1'; // very first element inside the form.
			var first_item    = '-1'; // first element with same table name. 
			$( jFormElem ).each( function( idx ) 
			{
				var this_fIdx     = $( this ).data( 'focusIndex' );
				var this_name     = $( this ).attr( 'name' );
				var this_nameBody = this_name.match( /^([\w]+)/ )[0];
				if( this_nameBody == fNameBody ) 
				{
					if( first_item === '-1' ) { 
						first_item = this_fIdx; 
					}
					if( this_fIdx > fIndex && toFocus_idx === '-1' ) {
						toFocus_idx = this_fIdx;
						// return false;
					}
					//$( jFormElem ).get( first_item ).focus();
					//alert( this_nameBody + this_fIdx );
				}
				else if( !this_name.match( /\[/ ) ) {
					if( top_item === '-1' ) {
						top_item = this_fIdx;
					}
					if( this_fIdx > fIndex && follow_item === '-1' ) {
						follow_item = this_fIdx;
					}
				}
			});
			if( toFocus_idx !== '-1' ) {
				$( jFormElem ).get( toFocus_idx ).focus();
			}
			else if( follow_item !== '-1' ) {
				$( jFormElem ).get( follow_item ).focus();
			}
			else if( top_item !== '-1' ) {
				$( jFormElem ).get( top_item ).focus();
			}
			else if( first_item !== '-1' ) {
				$( jFormElem ).get( first_item ).focus();
			}
			//alert( top_item + ' ' + follow_item );
			return;
			//alert( fNameBody[0] );
		}
		
		if( fIndex == jFormLeng-1 ) {
			$(jFormElem).get(0).focus();
		}
		else {
			$(jFormElem).get( fIndex+1 ).focus();
		}
		keyPropagate = false;
		return keyPropagate;
	};
	$(jFormElem).bind( 'keydown', 'ctrl+down', formDown );
    
	// +--------------------------------------------------------------+
	/**
     * Ctrl+UP: go up the table, or go to the previous element.
     */
    var formUp = function( event ) 
	{
		var keyPropagate = true;
		if( !focusElem ) return keyPropagate;
		if( !$(focusElem).data( 'focusIndex' ) ) return keyPropagate;
		
		var fIndex = parseInt( $(focusElem).data( 'focusIndex' ) );
		
		// find an element to focus.
		var fName  = $(focusElem).attr( 'name' );
		if( fName.match( /\[/ ) ) 
		{
			var fNameBody = fName.match( /^([\w]+)/ )[0];
			var toFocus_idx   = '-1'; // previous element with same table name. 
			var prev_item     = '-1'; // just the previous element.
			var bottom_item   = '-1'; // the last element with same table name. 
			var last_item     = '-1'; // the last element inside the form.
			$( jFormElem ).each( function( idx )
			{
				var this_fIdx     = $( this ).data( 'focusIndex' );
				var this_name     = $( this ).attr( 'name' );
				var this_nameBody = this_name.match( /^([\w]+)/ )[0];
				if( this_nameBody == fNameBody ) 
				{
					last_item = this_fIdx; 
					if( this_fIdx < fIndex ) {
						toFocus_idx = this_fIdx;
					}
					//$( jFormElem ).get( first_item ).focus();
				}
				else if( !this_name.match( /\[/ ) ) {
					bottom_item = this_fIdx;
					if( this_fIdx < fIndex  ) {
						prev_item = this_fIdx;
					}
				}
			});
			if( toFocus_idx !== '-1' ) {
				$( jFormElem ).get( toFocus_idx ).focus();
			}
			else if( prev_item !== '-1' ) {
				$( jFormElem ).get( prev_item ).focus();
			}
			else if( bottom_item !== '-1' ) {
				$( jFormElem ).get( bottom_item ).focus();
			}
			else if( last_item !== '-1' ) {
				$( jFormElem ).get( last_item ).focus();
			}
			return;
			//alert( fNameBody[0] );
		}
		
		if( fIndex == 0 ) {
			$(jFormElem).get( jFormLeng-1 ).focus();
		} 
		else {
			$(jFormElem).get( fIndex-1 ).focus();
		}
		keyPropagate = false;
		return keyPropagate;
	};
	$(jFormElem).bind( 'keydown', 'ctrl+up', formUp );
});
-->
</script>
<h1>Up/Down form with ctrl+↑↓→← keys</h1>
<p>Please use ctrl+up/down/left/right keys to navigate through html form in a row-table...<br>
</p>
<form name="form2" method="post" action="" id="form1">
<table>
  <tbody>
    <tr>
      <th width="78">ITEMS</th>
      <th width="508">VALUES</th>
    </tr>
    <tr>
      <td nowrap>Name of Table</td>
      <td><label>
        <input name="table_name" type="text" id="table_name" value="table name here..." size="40">
      </label></td>
    </tr>
    <tr>
      <td nowrap>Table</td>
      <td><table>
        <tr>
          <th>#</th>
          <th><span>name</span></th>
          <th><span>gender</span></th>
          <th><span>oversea<br>
            flag </span></th>
          <th><span>hidden<br>
            tag</span></th>
          <th><span>password</span></th>
        </tr>
        <tr>
          <td>1</td>
          <td><input name="name[0]" id="name[0]" style="ime-mode: active;" size="20" type="text">
          </td>
          <td align="center"><label>
            <select name="gender[0]" id="gender[0]">
              <option value="m">Mail</option>
              <option value="f">Femail</option>
            </select>
            </label>
          </td>
          <td align="center"><input name="addr_oversea_flag[0][]" id="addr_oversea_flag[0]1" value="2" type="checkbox">
          </td>
          <td><input name="hidden_tag[0]" type="hidden" value="hidden value">
          </td>
          <td><textarea name="password[0]" cols="10" rows="1" id="password[0]" style="ime-mode: inactive;">password</textarea>
          </td>
        </tr>
        <tr>
          <td>2</td>
          <td><input name="name[1]" id="name[1]" style="ime-mode: active;" size="20" type="text">
          </td>
          <td align="center"><select name="gender[1]" id="gender[1]">
            <option value="m">Mail</option>
            <option value="f">Femail</option>
          </select>
          </td>
          <td align="center"><input name="addr_oversea_flag[1][]" id="addr_oversea_flag[1]1" value="2" type="checkbox">
          </td>
          <td><input name="hidden_tag[1]" type="hidden" value="hidden value">
          </td>
          <td><textarea name="password[1]" cols="10" rows="1" id="password[1]" style="ime-mode: inactive;">password</textarea>
          </td>
        </tr>
        <tr>
          <td>3</td>
          <td><input name="name[2]" id="name[2]" style="ime-mode: active;" size="20" type="text">
          </td>
          <td align="center"><select name="gender[2]" id="gender[2]">
            <option value="m">Mail</option>
            <option value="f">Femail</option>
          </select>
                <label for="radio"></label>
                <label for="label"></label>
          </td>
          <td align="center"><input name="addr_oversea_flag[2][]" id="addr_oversea_flag[2]1" value="2" type="checkbox">
          </td>
          <td><input name="hidden_tag[2]" type="hidden" value="hidden value">
          </td>
          <td><textarea name="password[2]" cols="10" rows="1" id="password[2]" style="ime-mode: inactive;">password</textarea>
          </td>
        </tr>
      </table></td>
    </tr>
    <tr>
      <td nowrap>Comment</td>
      <td class="tdValue"><textarea name="comment" id="comment" cols="30" rows="4" style="ime-mode: inactive;">a text area here...</textarea>
      </td>
    </tr>
    <tr>
      <td colspan="2" align="center"><input id="submit_button" focusindex="13" name="Submit" value="This is Submit Button" type="submit">
          <input id="reset_button" focusindex="14" name="Reset" value="This is Reset" type="reset"></td>
    </tr>
  </tbody>
</table>
</form>
<br>
<br>
</body>
</html>
